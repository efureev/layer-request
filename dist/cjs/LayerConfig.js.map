{"version":3,"file":"LayerConfig.js","names":["buildBaseAxiosConfig","baseURL","headers","o","Object","create","LayerConfig","properties","request","response","axiosRequestConfig","interceptors","merge","extra","setExtra","withExtra","l","clone","toConfigObject","getExtra","name","isEmpty","Error","from","key","data","value","e","isObject"],"sources":["../../src/LayerConfig.ts"],"sourcesContent":["import { clone, isEmpty, isObject, merge } from '@feugene/mu'\n\nimport type { AxiosRequestConfig, AxiosResponse } from 'axios'\nimport type { Recordable } from './global'\n\nfunction buildBaseAxiosConfig(): AxiosRequestConfig {\n  return {\n    baseURL: `/`,\n    headers: {},\n  }\n}\n\nexport type InterceptorSuccessParam<T, R = T> = (value: T) => R | Promise<R>\nexport type InterceptorErrorParam = ((error: any) => any) | undefined\nexport type InterceptorNormal<T, R = T> = [InterceptorSuccessParam<T, R>, InterceptorErrorParam]\nexport type InterceptorType<T, R = T> = InterceptorSuccessParam<T, R> | InterceptorNormal<T, R>\n\nexport type InterceptorFn<T, R = T> = (layer: LayerConfig, extra: ExtraProperties) => InterceptorType<T, R>\n\nexport interface ConfigLayerInterceptors {\n  request: InterceptorFn<AxiosRequestConfig>[]\n  response: InterceptorFn<AxiosResponse>[]\n}\n\nexport interface ConfigLayerConstructor {\n  axiosRequestConfig: AxiosRequestConfig\n  interceptors?: Partial<ConfigLayerInterceptors>\n  from?: string\n  extra?: ExtraProperties\n}\n\nexport type ExtraProperties = Recordable\nexport type LayerConfigStringable = LayerConfig | string\n\nconst o = () => Object.create(null)\n\nexport class LayerConfig {\n  public axiosRequestConfig: AxiosRequestConfig = {}\n\n  private name?: string\n  public from?: string\n\n  private extra: ExtraProperties = o()\n\n  public interceptors: ConfigLayerInterceptors = {\n    request: [],\n    response: [],\n  }\n\n  constructor(properties?: ConfigLayerConstructor) {\n    this.axiosRequestConfig = properties?.axiosRequestConfig || buildBaseAxiosConfig()\n\n    this.interceptors = merge<ConfigLayerInterceptors>(\n      {\n        request: [],\n        response: [],\n      },\n      <ConfigLayerInterceptors>properties?.interceptors,\n    )\n\n    if (properties?.extra) {\n      this.setExtra(properties?.extra)\n    }\n  }\n\n  public clone(withExtra: boolean = false): LayerConfig {\n    const l = new LayerConfig(clone<ConfigLayerConstructor>(this.toConfigObject()))\n    if (withExtra) {\n      l.setExtra(this.getExtra())\n    }\n\n    return l\n  }\n\n  public getName(): string {\n    return <string>this.name\n  }\n\n  public setName(name?: string): void {\n    if (isEmpty(name)) {\n      if (isEmpty(this.axiosRequestConfig.baseURL)) {\n        throw Error('You should add `name` to your layer or config must contains `baseURL` attribute!')\n      }\n\n      name = this.axiosRequestConfig.baseURL\n    }\n\n    this.name = name\n  }\n\n  protected toConfigObject(): ConfigLayerConstructor {\n    return {\n      axiosRequestConfig: this.axiosRequestConfig,\n      interceptors: this.interceptors,\n      from: this.from,\n    }\n  }\n\n  public getExtra(key?: string): ExtraProperties | any {\n    return key ? this.extra[key] : this.extra\n  }\n\n  public setExtra(data: ExtraProperties | string, value?: any): void {\n    if (typeof data === 'string') {\n      const e = o()\n      e[data] = value\n      data = e\n    }\n\n    if (isObject(data)) {\n      this.extra = {\n        ...this.extra,\n        ...(<ExtraProperties>data),\n      }\n    }\n  }\n}\n\nexport default LayerConfig\n"],"mappings":";;;;;;AAAA;AAA6D;AAAA;AAAA;AAAA;AAAA;AAAA;AAK7D,SAASA,oBAAoB,GAAuB;EAClD,OAAO;IACLC,OAAO,KAAK;IACZC,OAAO,EAAE,CAAC;EACZ,CAAC;AACH;AAwBA,IAAMC,CAAC,GAAG,SAAJA,CAAC;EAAA,OAASC,MAAM,CAACC,MAAM,CAAC,IAAI,CAAC;AAAA;AAAA,IAEtBC,WAAW;EAatB,qBAAYC,UAAmC,EAAE;IAAA;IAAA,4CAZD,CAAC,CAAC;IAAA,+BAKjBJ,CAAC,EAAE;IAAA,sCAEW;MAC7CK,OAAO,EAAE,EAAE;MACXC,QAAQ,EAAE;IACZ,CAAC;IAGC,IAAI,CAACC,kBAAkB,GAAG,CAAAH,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEG,kBAAkB,KAAIV,oBAAoB,EAAE;IAElF,IAAI,CAACW,YAAY,GAAG,IAAAC,SAAK,EACvB;MACEJ,OAAO,EAAE,EAAE;MACXC,QAAQ,EAAE;IACZ,CAAC,EACwBF,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEI,YAAY,CAClD;IAED,IAAIJ,UAAU,aAAVA,UAAU,eAAVA,UAAU,CAAEM,KAAK,EAAE;MACrB,IAAI,CAACC,QAAQ,CAACP,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEM,KAAK,CAAC;IAClC;EACF;EAAC;IAAA;IAAA,OAED,iBAAsD;MAAA,IAAzCE,SAAkB,uEAAG,KAAK;MACrC,IAAMC,CAAC,GAAG,IAAIV,WAAW,CAAC,IAAAW,SAAK,EAAyB,IAAI,CAACC,cAAc,EAAE,CAAC,CAAC;MAC/E,IAAIH,SAAS,EAAE;QACbC,CAAC,CAACF,QAAQ,CAAC,IAAI,CAACK,QAAQ,EAAE,CAAC;MAC7B;MAEA,OAAOH,CAAC;IACV;EAAC;IAAA;IAAA,OAED,mBAAyB;MACvB,OAAe,IAAI,CAACI,IAAI;IAC1B;EAAC;IAAA;IAAA,OAED,iBAAeA,IAAa,EAAQ;MAClC,IAAI,IAAAC,WAAO,EAACD,IAAI,CAAC,EAAE;QACjB,IAAI,IAAAC,WAAO,EAAC,IAAI,CAACX,kBAAkB,CAACT,OAAO,CAAC,EAAE;UAC5C,MAAMqB,KAAK,CAAC,kFAAkF,CAAC;QACjG;QAEAF,IAAI,GAAG,IAAI,CAACV,kBAAkB,CAACT,OAAO;MACxC;MAEA,IAAI,CAACmB,IAAI,GAAGA,IAAI;IAClB;EAAC;IAAA;IAAA,OAED,0BAAmD;MACjD,OAAO;QACLV,kBAAkB,EAAE,IAAI,CAACA,kBAAkB;QAC3CC,YAAY,EAAE,IAAI,CAACA,YAAY;QAC/BY,IAAI,EAAE,IAAI,CAACA;MACb,CAAC;IACH;EAAC;IAAA;IAAA,OAED,kBAAgBC,GAAY,EAAyB;MACnD,OAAOA,GAAG,GAAG,IAAI,CAACX,KAAK,CAACW,GAAG,CAAC,GAAG,IAAI,CAACX,KAAK;IAC3C;EAAC;IAAA;IAAA,OAED,kBAAgBY,IAA8B,EAAEC,KAAW,EAAQ;MACjE,IAAI,OAAOD,IAAI,KAAK,QAAQ,EAAE;QAC5B,IAAME,CAAC,GAAGxB,CAAC,EAAE;QACbwB,CAAC,CAACF,IAAI,CAAC,GAAGC,KAAK;QACfD,IAAI,GAAGE,CAAC;MACV;MAEA,IAAI,IAAAC,YAAQ,EAACH,IAAI,CAAC,EAAE;QAClB,IAAI,CAACZ,KAAK,mCACL,IAAI,CAACA,KAAK,GACQY,IAAI,CAC1B;MACH;IACF;EAAC;EAAA;AAAA;AAAA;AAAA,eAGYnB,WAAW;AAAA"}