{"version":3,"file":"LayerConfig.js","names":["buildBaseAxiosConfig","baseURL","headers","o","Object","create","LayerConfig","properties","request","response","axiosRequestConfig","interceptors","merge","extra","setExtra","clone","toConfigObject","name","isEmpty","Error","from","key","data","value","e","isObject"],"sources":["../../src/LayerConfig.ts"],"sourcesContent":["import { clone, isEmpty, isObject, merge } from '@feugene/mu'\nimport type { AxiosRequestConfig, AxiosResponse } from 'axios'\nimport type { Recordable } from './global'\n\nfunction buildBaseAxiosConfig(): AxiosRequestConfig {\n  return {\n    baseURL: `/`,\n    headers: {},\n  }\n}\n\nexport type InterceptorSuccessParam<T> = (value: T) => T | Promise<T>\nexport type InterceptorErrorParam = ((error: any) => any) | undefined\nexport type InterceptorNormal<T> = [InterceptorSuccessParam<T>, InterceptorErrorParam] // | [InterceptorSuccessParam<T>]\nexport type InterceptorType<T> = InterceptorSuccessParam<T> | InterceptorNormal<T>\n\nexport type InterceptorFn<T> = (layer: LayerConfig, extra: ExtraProperties) => InterceptorType<T>\n\nexport interface ConfigLayerInterceptors {\n  request: InterceptorFn<AxiosRequestConfig>[]\n  response: InterceptorFn<AxiosResponse>[]\n}\n\nexport interface ConfigLayerConstructor {\n  axiosRequestConfig: AxiosRequestConfig\n  interceptors: Partial<ConfigLayerInterceptors>\n  from?: string\n  extra?: ExtraProperties\n}\n\nexport type ExtraProperties = Recordable\nexport type LayerConfigStringable = LayerConfig | string\n\nconst o = () => Object.create(null)\n\nexport class LayerConfig {\n  public axiosRequestConfig: AxiosRequestConfig = {}\n\n  private name?: string\n  public from?: string\n\n  private extra: ExtraProperties = o()\n\n  public interceptors: ConfigLayerInterceptors = {\n    request: [],\n    response: [],\n  }\n\n  constructor(properties?: ConfigLayerConstructor) {\n    this.axiosRequestConfig = properties?.axiosRequestConfig || buildBaseAxiosConfig()\n\n    this.interceptors = merge(\n      {\n        request: [],\n        response: [],\n      },\n      <ConfigLayerInterceptors>properties?.interceptors,\n    ) as ConfigLayerInterceptors\n\n    if (properties?.extra) {\n      this.setExtra(properties?.extra)\n    }\n  }\n\n  public clone(): LayerConfig {\n    return new LayerConfig(clone(this.toConfigObject()))\n  }\n\n  public getName(): string {\n    return <string>this.name\n  }\n\n  public setName(name?: string): void {\n    if (isEmpty(name)) {\n      if (isEmpty(this.axiosRequestConfig.baseURL)) {\n        throw Error('You should add `name` to your layer or config must contains `baseURL` attribute!')\n      }\n\n      name = this.axiosRequestConfig.baseURL\n    }\n\n    this.name = name\n  }\n\n  protected toConfigObject(): ConfigLayerConstructor {\n    return {\n      axiosRequestConfig: this.axiosRequestConfig,\n      interceptors: this.interceptors,\n      from: this.from,\n    }\n  }\n\n  public getExtra(key?: string): ExtraProperties | any {\n    return key ? this.extra[key] : this.extra\n  }\n\n  public setExtra(data: ExtraProperties | string, value?: any): void {\n    if (typeof data === 'string') {\n      const e = o()\n      e[data] = value\n      data = e\n    }\n\n    if (isObject(data)) {\n      this.extra = {\n        ...this.extra,\n        ...<ExtraProperties>data,\n      }\n    }\n  }\n}\n\nexport default LayerConfig\n"],"mappings":";;;;;;;AAAA;;;;;;;;;;;;;;AAIA,SAASA,oBAAT,GAAoD;EAClD,OAAO;IACLC,OAAO,KADF;IAELC,OAAO,EAAE;EAFJ,CAAP;AAID;;AAwBD,IAAMC,CAAC,GAAG,SAAJA,CAAI;EAAA,OAAMC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAN;AAAA,CAAV;;IAEaC,W;EAaX,qBAAYC,UAAZ,EAAiD;IAAA;;IAAA,4CAZD,EAYC;;IAAA,+BAPhBJ,CAAC,EAOe;;IAAA,sCALF;MAC7CK,OAAO,EAAE,EADoC;MAE7CC,QAAQ,EAAE;IAFmC,CAKE;;IAC/C,KAAKC,kBAAL,GAA0B,CAAAH,UAAU,SAAV,IAAAA,UAAU,WAAV,YAAAA,UAAU,CAAEG,kBAAZ,KAAkCV,oBAAoB,EAAhF;IAEA,KAAKW,YAAL,GAAoB,IAAAC,SAAA,EAClB;MACEJ,OAAO,EAAE,EADX;MAEEC,QAAQ,EAAE;IAFZ,CADkB,EAKOF,UALP,aAKOA,UALP,uBAKOA,UAAU,CAAEI,YALnB,CAApB;;IAQA,IAAIJ,UAAJ,aAAIA,UAAJ,eAAIA,UAAU,CAAEM,KAAhB,EAAuB;MACrB,KAAKC,QAAL,CAAcP,UAAd,aAAcA,UAAd,uBAAcA,UAAU,CAAEM,KAA1B;IACD;EACF;;;;WAED,iBAA4B;MAC1B,OAAO,IAAIP,WAAJ,CAAgB,IAAAS,SAAA,EAAM,KAAKC,cAAL,EAAN,CAAhB,CAAP;IACD;;;WAED,mBAAyB;MACvB,OAAe,KAAKC,IAApB;IACD;;;WAED,iBAAeA,IAAf,EAAoC;MAClC,IAAI,IAAAC,WAAA,EAAQD,IAAR,CAAJ,EAAmB;QACjB,IAAI,IAAAC,WAAA,EAAQ,KAAKR,kBAAL,CAAwBT,OAAhC,CAAJ,EAA8C;UAC5C,MAAMkB,KAAK,CAAC,kFAAD,CAAX;QACD;;QAEDF,IAAI,GAAG,KAAKP,kBAAL,CAAwBT,OAA/B;MACD;;MAED,KAAKgB,IAAL,GAAYA,IAAZ;IACD;;;WAED,0BAAmD;MACjD,OAAO;QACLP,kBAAkB,EAAE,KAAKA,kBADpB;QAELC,YAAY,EAAE,KAAKA,YAFd;QAGLS,IAAI,EAAE,KAAKA;MAHN,CAAP;IAKD;;;WAED,kBAAgBC,GAAhB,EAAqD;MACnD,OAAOA,GAAG,GAAG,KAAKR,KAAL,CAAWQ,GAAX,CAAH,GAAqB,KAAKR,KAApC;IACD;;;WAED,kBAAgBS,IAAhB,EAAgDC,KAAhD,EAAmE;MACjE,IAAI,OAAOD,IAAP,KAAgB,QAApB,EAA8B;QAC5B,IAAME,CAAC,GAAGrB,CAAC,EAAX;QACAqB,CAAC,CAACF,IAAD,CAAD,GAAUC,KAAV;QACAD,IAAI,GAAGE,CAAP;MACD;;MAED,IAAI,IAAAC,YAAA,EAASH,IAAT,CAAJ,EAAoB;QAClB,KAAKT,KAAL,mCACK,KAAKA,KADV,GAEsBS,IAFtB;MAID;IACF;;;;;;;eAGYhB,W"}