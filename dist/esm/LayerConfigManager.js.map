{"version":3,"file":"LayerConfigManager.js","names":["isFunction","isObject","LayerConfig","layers","Map","LayerConfigManager","addLayer","configValue","name","Error","axiosRequestConfig","setName","set","getName","getLayer","throws","l","get","list","Array","from","keys","all","reset","clear","addCopyFrom","fromLayer","fn","newLayer","copy","copyFrom","layerCopy","copyLayer","clone","updateLayer","createLayer","options","manager"],"sources":["../../src/LayerConfigManager.ts"],"sourcesContent":["import type { AxiosRequestConfig } from 'axios'\nimport { isFunction, isObject } from '@feugene/mu'\nimport type { LayerConfigStringable } from './LayerConfig'\nimport LayerConfig, { ConfigLayerConstructor } from './LayerConfig'\nimport type { Nullable } from './global'\n\nconst layers = new Map<string, LayerConfig>()\n\ntype CreateLayerConfigFunction = (manager: LayerConfigManager) => AxiosRequestConfig | LayerConfig\ntype CreateLayerConfig = AxiosRequestConfig | LayerConfig | CreateLayerConfigFunction\ntype ModifyLayerConfigFn = (l: LayerConfig) => void\ntype CopyLayerConfigFn = (target: LayerConfig, source: LayerConfig) => void\n\nexport class LayerConfigManager {\n\n  addLayer(configValue: CreateLayerConfig, name?: string): LayerConfig {\n    if (isFunction(configValue)) {\n      return this.addLayer((<CreateLayerConfigFunction>configValue)(this), name)\n    }\n\n    if (!isObject(configValue)) {\n      throw Error('Invalid type of config!')\n    }\n\n    if (!(configValue instanceof LayerConfig)) {\n      configValue = new LayerConfig(<ConfigLayerConstructor>{ axiosRequestConfig: configValue })\n    }\n\n    configValue.setName(name)\n\n    layers.set(configValue.getName(), configValue)\n\n    return configValue\n  }\n\n  getLayer(name: LayerConfigStringable, throws: boolean = false): Nullable<LayerConfig> {\n    if (name instanceof LayerConfig) {\n      return name\n    }\n\n    const l = layers.get(name)\n    if (l) {\n      return l\n    }\n\n    if (throws) {\n      throw Error(`Config Layer with name '${name}' not found`)\n    }\n\n    return null\n  }\n\n\n  list(): string[] {\n    return Array.from(layers.keys()) //.map(name => name)\n  }\n\n  all(): Map<string, LayerConfig> {\n    return layers\n  }\n\n  reset(): this {\n    layers.clear()\n\n    return this\n  }\n\n  /**\n   * Add a copy of an existing LayerConfig to the Layer Manager\n   */\n  addCopyFrom(fromLayer: LayerConfigStringable, fn: CopyLayerConfigFn, newLayer?: string): LayerConfig {\n    const copy = this.copyFrom(fromLayer, fn)\n\n    return this.addLayer(copy, newLayer)\n  }\n\n  /**\n   * Copy a LayerConfig from an existing LayerConfig and set it up\n   */\n  copyFrom(fromLayer: LayerConfigStringable, fn: CopyLayerConfigFn): LayerConfig {\n    fromLayer = <LayerConfig>this.getLayer(fromLayer, true)\n    const layerCopy = this.copyLayer(fromLayer)\n\n    layerCopy.from = fromLayer.getName()\n\n    fn(layerCopy, fromLayer)\n\n    return layerCopy\n  }\n\n  /**\n   * Copy a LayerConfig from an existing LayerConfig\n   */\n  copyLayer(name: LayerConfigStringable): LayerConfig {\n    if (name instanceof LayerConfig) {\n      name = name.getName()\n    }\n\n    const l = <LayerConfig>this.getLayer(name, true)\n    return l.clone()\n  }\n\n  /**\n   * Update a LayerConfig by its name\n   */\n  updateLayer(name: string, fn: ModifyLayerConfigFn): this {\n    const l = this.getLayer(name, true)\n\n    fn(<LayerConfig>l)\n\n    return this\n  }\n\n  createLayer(options: ConfigLayerConstructor): LayerConfig {\n    return new LayerConfig(options)\n  }\n}\n\nconst manager = new LayerConfigManager()\n\nexport default manager\n"],"mappings":"AACA,SAASA,UAAT,EAAqBC,QAArB,QAAqC,aAArC;AAEA,OAAOC,WAAP,MAAoD,eAApD;AAGA,MAAMC,MAAM,GAAG,IAAIC,GAAJ,EAAf;AAOA,OAAO,MAAMC,kBAAN,CAAyB;EAE9BC,QAAQ,CAACC,WAAD,EAAiCC,IAAjC,EAA6D;IACnE,IAAIR,UAAU,CAACO,WAAD,CAAd,EAA6B;MAC3B,OAAO,KAAKD,QAAL,CAA0CC,WAA5B,CAAyC,IAAzC,CAAd,EAA8DC,IAA9D,CAAP;IACD;;IAED,IAAI,CAACP,QAAQ,CAACM,WAAD,CAAb,EAA4B;MAC1B,MAAME,KAAK,CAAC,yBAAD,CAAX;IACD;;IAED,IAAI,EAAEF,WAAW,YAAYL,WAAzB,CAAJ,EAA2C;MACzCK,WAAW,GAAG,IAAIL,WAAJ,CAAwC;QAAEQ,kBAAkB,EAAEH;MAAtB,CAAxC,CAAd;IACD;;IAEDA,WAAW,CAACI,OAAZ,CAAoBH,IAApB;IAEAL,MAAM,CAACS,GAAP,CAAWL,WAAW,CAACM,OAAZ,EAAX,EAAkCN,WAAlC;IAEA,OAAOA,WAAP;EACD;;EAEDO,QAAQ,CAACN,IAAD,EAA8BO,MAAe,GAAG,KAAhD,EAA8E;IACpF,IAAIP,IAAI,YAAYN,WAApB,EAAiC;MAC/B,OAAOM,IAAP;IACD;;IAED,MAAMQ,CAAC,GAAGb,MAAM,CAACc,GAAP,CAAWT,IAAX,CAAV;;IACA,IAAIQ,CAAJ,EAAO;MACL,OAAOA,CAAP;IACD;;IAED,IAAID,MAAJ,EAAY;MACV,MAAMN,KAAK,CAAE,2BAA0BD,IAAK,aAAjC,CAAX;IACD;;IAED,OAAO,IAAP;EACD;;EAGDU,IAAI,GAAa;IACf,OAAOC,KAAK,CAACC,IAAN,CAAWjB,MAAM,CAACkB,IAAP,EAAX,CAAP,CADe,CACkB;EAClC;;EAEDC,GAAG,GAA6B;IAC9B,OAAOnB,MAAP;EACD;;EAEDoB,KAAK,GAAS;IACZpB,MAAM,CAACqB,KAAP;IAEA,OAAO,IAAP;EACD;EAED;AACF;AACA;;;EACEC,WAAW,CAACC,SAAD,EAAmCC,EAAnC,EAA0DC,QAA1D,EAA0F;IACnG,MAAMC,IAAI,GAAG,KAAKC,QAAL,CAAcJ,SAAd,EAAyBC,EAAzB,CAAb;IAEA,OAAO,KAAKrB,QAAL,CAAcuB,IAAd,EAAoBD,QAApB,CAAP;EACD;EAED;AACF;AACA;;;EACEE,QAAQ,CAACJ,SAAD,EAAmCC,EAAnC,EAAuE;IAC7ED,SAAS,GAAgB,KAAKZ,QAAL,CAAcY,SAAd,EAAyB,IAAzB,CAAzB;IACA,MAAMK,SAAS,GAAG,KAAKC,SAAL,CAAeN,SAAf,CAAlB;IAEAK,SAAS,CAACX,IAAV,GAAiBM,SAAS,CAACb,OAAV,EAAjB;IAEAc,EAAE,CAACI,SAAD,EAAYL,SAAZ,CAAF;IAEA,OAAOK,SAAP;EACD;EAED;AACF;AACA;;;EACEC,SAAS,CAACxB,IAAD,EAA2C;IAClD,IAAIA,IAAI,YAAYN,WAApB,EAAiC;MAC/BM,IAAI,GAAGA,IAAI,CAACK,OAAL,EAAP;IACD;;IAED,MAAMG,CAAC,GAAgB,KAAKF,QAAL,CAAcN,IAAd,EAAoB,IAApB,CAAvB;IACA,OAAOQ,CAAC,CAACiB,KAAF,EAAP;EACD;EAED;AACF;AACA;;;EACEC,WAAW,CAAC1B,IAAD,EAAemB,EAAf,EAA8C;IACvD,MAAMX,CAAC,GAAG,KAAKF,QAAL,CAAcN,IAAd,EAAoB,IAApB,CAAV;IAEAmB,EAAE,CAAcX,CAAd,CAAF;IAEA,OAAO,IAAP;EACD;;EAEDmB,WAAW,CAACC,OAAD,EAA+C;IACxD,OAAO,IAAIlC,WAAJ,CAAgBkC,OAAhB,CAAP;EACD;;AAtG6B;AAyGhC,MAAMC,OAAO,GAAG,IAAIhC,kBAAJ,EAAhB;AAEA,eAAegC,OAAf"}